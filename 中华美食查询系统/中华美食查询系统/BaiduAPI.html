<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <style type="text/css">
        body, html {
            width: 100%;
            height: 100%;
            margin: 0;
            font-family: "微软雅黑";
        }

        #allmap {
            width: 1220px;
            height: 480px;
        }

        p {
            margin-left: 5px;
            font-size: 14px;
        }
    </style>
 
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=你自己申请的百度地图API的ak(密钥)"></script>
    <!--加载鼠标测距工具-->
    <script src="DistanceTool_min.js" type="text/javascript"></script>
</head>
<body>
    <div id="mouselng" style="visibility:hidden"></div>
    <div id="mouselat" style="visibility:hidden"></div>
    <div id="cityName" style="visibility:hidden"></div>
    <div  id="allmap"> </div>
</body>
</html>
<script type="text/javascript">
    var map = new BMap.Map("allmap");
    var point = new BMap.Point(126.56628, 45.87217);  // 创建点坐标  
    map.centerAndZoom(point, 15);                 // 初始化地图，设置中心点坐标和地图级别 
    //两种地图和缩略图
    map.enableScrollWheelZoom(true);
    var mapType1 = new BMap.MapTypeControl(
		{
		    mapTypes: [BMAP_NORMAL_MAP, BMAP_HYBRID_MAP],
		    anchor: BMAP_ANCHOR_TOP_RIGHT
		}
	);
    var overView = new BMap.OverviewMapControl();
    var overViewOpen = new BMap.OverviewMapControl({ isOpen: true, anchor: BMAP_ANCHOR_BOTTOM_RIGHT });
    map.addControl(mapType1);          //2D图，混合图
    map.addControl(overView);          //添加默认缩略地图控件
    map.addControl(overViewOpen);       // opean
    map.addControl(new BMap.ScaleControl()); //添加比例尺控件(左下角显示的比例尺控件)
    var ctrl_nav = new BMap.NavigationControl({ anchor: BMAP_ANCHOR_TOP_LEFT, type: BMAP_NAVIGATION_CONTROL_LARGE });
    map.addControl(ctrl_nav);//添加标准地图控件(左上角的放大缩小左右拖拽控件)
    map.enableScrollWheelZoom(); //启用地图滚轮放大缩小
    map.enableKeyboard(); //启用键盘上下左右键移动地图
    map.enableContinuousZoom();   // 开启连续缩放效果
    map.enableInertialDragging(); // 开启惯性拖拽效果



  //实时显示地图坐标 strat
    map.addEventListener("mousemove",GetlngAndlat);
    function GetlngAndlat(e) {
    if(e.point.lng!=null)
     {
      document.getElementById("mouselng").innerHTML=e.point.lng;
      document.getElementById("mouselat").innerHTML=e.point.lat;
     }
}
    //实时显示地图坐标 end

   //测量距离 strat
    function openGetDistance() {
     var myDis=new BMapLib.DistanceTool(map);//map为上面已经初始化好的地图实例
     myDis.open();
    }
    //测量距离 end


    //左右击鼠标给地图上放marker strat 放标注
    var marker_num = 0;
    var isAddListen = -1;
    function PutInMarker() {
        //右键标记
        if (isAddListen == -1) {
            //k添加右键点击的监听事件
            map.addEventListener("rightclick", putmarker);
            isAddListen = 0;
        }
    }

    var g_rightP = new BMap.Point(0, 0);
    function putmarker(e)
    {
        //放标注
        var p1 = new BMap.Point(e.point.lng, e.point.lat);
        g_rightP = p1;
        var myIcon = new BMap.Icon("car.png", new BMap.Size(24, 24));
        var marker = new BMap.Marker(p1, { icon: myIcon });  // 创建标注
        map.addOverlay(marker);              // 将标注添加到地图中

        marker_num++;//标注索引，这个是个全局变量
        var whichCar = window.external.setWhichCar(marker_num);
        var label=new BMap.Label(whichCar+"号-坐标"+marker_num+":"+
        "("+e.point.lng+","+e.point.lat+")",{offset:new BMap.Size(20,-10)});
        marker.setLabel(label);
    }
    //左右击鼠标给地图上放marker end


    //清除所有标注 start
    function ClearAllMarkers() {
        map.clearOverlays();
        marker_num = 0;
        isAddListen = -1;
    }
    //清除所有标注 end



    //关闭监听事件，恢复对地图的操作 sta
   
    function CloseListener() {
        map.removeEventListener("rightclick", putmarker);
    }
    //关闭监听事件，恢复对地图的操作 end

    //坐标反查 start
    function FindPosition(CurLng, CurLat) {
        //百度地图API功能，经度，纬度
        var point = new BMap.Point(CurLng, CurLat);
        map.centerAndZoom(point, 20);
    }
    function theLocation() {
        var city = document.getElementById("cityName").innerHTML;
        //var map = new BMap.Map("allmap");
        map.centerAndZoom(city, 11);// 用城市名设置地图中心点
        var local = new BMap.LocalSearch(city, {
                renderOptions: { map: map }
            });
            local.search("美食");
        
    }
    //坐标反查 end

    //获取测试坐标 start
    var Lng = 116.380960
    var Lat = 39.913280
    function GetTestGPS(CurLng, CurLat) {
        //百度地图API功能，经度，纬度
        var point = new BMap.Point(CurLng, CurLat);
        map.centerAndZoom(point, 20);
        window.external.LocateInfo(text);
        return Lng;
    }
    //获取测试坐标 end

    //获取测试坐标数组2 start
    function GetTest2GPS() {
        var text = '{"Point":[{"x":"116.380960","y":"39.913280"},{"x":"116.380961","y":"39.913281"},{"x":"116.380962","y":"39.913282"},{"x":"116.380963","y":"39.913283"}]}'
        window.external.LocateInfo(text);
        return text;
    }
    //获取测试坐标 end
</script>

